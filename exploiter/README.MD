# Exploits Written for Example Vulnerable Contract

| **#** | **Vulnerability Type**                                                               | **Contract**                                                | **DCR Model**                                                                                                                                   | **Notes on DCR Model**                                                                                                                      | **The way to exploit**                                                                                                                           |
| ----- | ------------------------------------------------------------------------------------ | ----------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------ |
| 1     | Time-based Vulnerability (related to Automatic Deprecation and Time Incentivization) | [ProductOrder](contracts/source/ProductOrder.sol)           | [1701030](https://dcrgraphs.net/Tool?id=1701030) [View Publicly](https://dcrgraphs.net/tool/main/Graph?id=53d090df-ca7c-4b38-bde6-1cac4c0f551c) | We make the assumption that the applyDiscount is part of payForOrder and not modeled (captured by the model). Therefore, the model does not | Call the constructor with (2, 60); Make a transaction to applyDiscount (1); Delay for 60 seconds and make another transaction to confirmOrder(); |
| 2     | Time-based                                                                           | [PrizeDistribution](contracts/source/PrizeDistribution.sol) | [1701044](https://dcrgraphs.net/Tool?id=1701044)                                                                                                | We have to rely on [this](https://github.com/mojtaba-eshghie/Clawk/issues/37) for this model to be useful                                   |                                                                                                                                                  |
| 3     | Action ordering (lack of proper guard condition on multiple functions)               | [MultiStageAuction](/exploiter/contracts/source/)           | [1701049](https://dcrgraphs.net/Tool?id=1701049)                                                                                                |                                                                                                                                             |                                                                                                                                                  |
| 4     |                                                                                      |                                                             |                                                                                                                                                 |                                                                                                                                             |                                                                                                                                                  |
| 5     |                                                                                      |                                                             |                                                                                                                                                 |                                                                                                                                             |                                                                                                                                                  |

## Exploiting MultiStageAuction

### Commit Phase:

1. Commit a bid using the `commitBid` function.

   - To generate a hashed bid for, let's say, 5 ether with the secret "mySecret", you can use the following JavaScript code in a browser console or Node.js environment:

   ```javascript
   web3.utils.keccak256(web3.utils.toWei("5", "ether") + "mySecret");
   ```

   - This will give you a hashed value. Let's assume the hashed value is `0x1234567890abcdef....`.
   - In Remix, call the `commitBid` function with the hashed value `0x1234567890abcdef....`.

### Exploit:

1. While still in the Commit Phase (i.e., before calling `endCommitPhase`), reveal the bid using the `revealBid` function.
   - Call the `revealBid` function with parameters:
     - `amount`: `5000000000000000000` (This represents 5 ether in wei)
     - `secret`: "mySecret"

By following these steps, you've successfully revealed your bid during the Commit Phase, exploiting the vulnerability in the contract.

### Verification:

1. To verify the exploit, you can check the `highestBid` and `highestBidder` variables in Remix after the `revealBid` call. They should be set to 5 ether and the address of the exploiter, respectively.

### Attack code:

```javascript
const Web3 = require("web3");
const web3 = new Web3();

function generateHash(amountInEther, secret) {
  const amountInWei = web3.utils.toWei(amountInEther.toString(), "ether");
  const hashedValue = web3.utils.keccak256(amountInWei.toString() + secret);
  return hashedValue;
}

console.log(generateHash(5, "mySecret"));
```

**Hash you should use for `commitBid` is (result of running the exploit js):**  
`0xd233b7be403e28e5b0968965e572505c16a10e74d7cf1486670213746df467ca`

---
